<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Futuristic Loan Tracker</title>
<script src="https://cdn.tailwindcss.com"></script>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap" rel="stylesheet">
<style>
body {
  font-family: 'Inter', sans-serif;
  background: linear-gradient(135deg, #0f2027, #203a43, #2c5364);
  color: #f4f7f9;
}
.container-card {
  box-shadow: 0 10px 30px rgba(0,0,0,0.4);
  background: rgba(255,255,255,0.05);
  backdrop-filter: blur(10px);
  border-radius: 15px;
  border: 1px solid rgba(255,255,255,0.2);
}
.scrollable-list {
  max-height: 450px;
  overflow-y: auto;
}
.scrollable-list::-webkit-scrollbar { width: 6px; }
.scrollable-list::-webkit-scrollbar-thumb { background-color: #10b981; border-radius:3px; }
button:hover { transform: scale(1.05); transition: 0.2s; }
#auth-container {
  background: url('https://images.unsplash.com/photo-1508923567004-3a6b8004f3d5?auto=format&fit=crop&w=800&q=80') no-repeat center center/cover;
  color: #fff;
  backdrop-filter: blur(10px);
  border-radius: 15px;
  padding: 2rem;
}
#auth-container input {
  background: rgba(255,255,255,0.1);
  border: 1px solid rgba(255,255,255,0.3);
  color: #fff;
}
#auth-container input::placeholder { color: rgba(255,255,255,0.7); }
</style>
</head>
<body class="min-h-screen p-4 sm:p-8">

<!-- Authentication Container -->
<div id="auth-container" class="max-w-md mx-auto mt-20">
  <h2 class="text-3xl font-extrabold mb-6 text-center">Welcome Back!</h2>
  <div id="auth-error-message" class="hidden bg-red-600/50 px-4 py-3 rounded mb-4"></div>
  <form id="auth-form" class="space-y-4">
    <input type="email" id="auth-email" required placeholder="Email" class="w-full p-3 rounded-lg">
    <input type="password" id="auth-password" required placeholder="Password" class="w-full p-3 rounded-lg">
    <div class="flex space-x-4 pt-2">
      <button type="button" id="login-button" class="w-full bg-teal-500 p-3 rounded-lg font-semibold">Log In</button>
      <button type="button" id="signup-button" class="w-full bg-indigo-500 p-3 rounded-lg font-semibold">Sign Up</button>
    </div>
  </form>
</div>

<!-- Main App -->
<div id="app" class="max-w-5xl mx-auto hidden">

<header class="flex justify-between items-center mb-6">
  <h1 class="text-4xl font-extrabold flex items-center">Futuristic Loan Tracker</h1>
  <button id="signout-button" class="bg-red-500 text-white px-4 py-2 rounded-lg hover:bg-red-600">Sign Out</button>
</header>

<!-- User Info -->
<div class="mb-6 p-4 container-card flex justify-between items-center">
  <p class="text-sm">Status: <span id="auth-status" class="text-green-400 font-bold">Authenticated</span> | User ID: <span id="user-id" class="text-xs break-all bg-gray-800/50 p-1 rounded">Loading...</span></p>
</div>

<!-- Summary -->
<div id="summary" class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-8">
  <div class="p-5 container-card border-l-4 border-teal-400"><p class="text-sm font-medium">Current Active Loans</p><p id="total-loaned" class="mt-1 text-3xl font-semibold">--</p></div>
  <div class="p-5 container-card border-l-4 border-amber-400"><p class="text-sm font-medium">Total Loaned</p><p id="total-all-time" class="mt-1 text-3xl font-semibold">--</p></div>
  <div class="p-5 container-card border-l-4 border-green-400"><p class="text-sm font-medium">Total Paid</p><p id="total-paid" class="mt-1 text-3xl font-semibold">--</p></div>
</div>

<!-- Add Loan Form -->
<div class="p-6 container-card mb-8">
<h2 class="text-xl font-bold mb-4">Record New Loan</h2>
<form id="add-loan-form" class="grid grid-cols-1 sm:grid-cols-4 gap-4 items-end">
  <input type="text" id="borrower-name" required placeholder="Borrower Name" class="w-full p-2 rounded-lg">
  <input type="number" id="loan-amount" required min="0.01" step="0.01" placeholder="Amount (INR)" class="w-full p-2 rounded-lg">
  <button type="submit" id="submit-button" class="w-full sm:col-span-1 bg-teal-500 p-2 rounded-lg font-semibold">Add Loan</button>
</form>
</div>

<!-- Loan List -->
<div class="p-6 container-card">
<h2 class="text-xl font-bold mb-4">User Loans</h2>
<div id="user-loans-list" class="divide-y divide-gray-600 scrollable-list mb-6"></div>
<h2 class="text-xl font-bold mb-4">Global Loans</h2>
<div id="global-loans-list" class="divide-y divide-gray-600 scrollable-list"></div>
</div>

<!-- Firebase SDK -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
import { getFirestore, collection, addDoc, updateDoc, deleteDoc, onSnapshot, serverTimestamp, doc, query, orderBy } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyBlpcrpLA14LKvQy_G5GELJNIeG9Sn_yIk",
  authDomain: "loan-tracker-app-d7e0c.firebaseapp.com",
  projectId: "loan-tracker-app-d7e0c",
  storageBucket: "loan-tracker-app-d7e0c.firebasestorage.app",
  messagingSenderId: "958201169143",
  appId: "1:958201169143:web:35803b69eb0d18a7a17ff2",
  measurementId: "G-Q67R68ZWZ3"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

const authContainerEl = document.getElementById('auth-container');
const loginButton = document.getElementById('login-button');
const signupButton = document.getElementById('signup-button');
const signoutButton = document.getElementById('signout-button');
const authEmailInput = document.getElementById('auth-email');
const authPasswordInput = document.getElementById('auth-password');
const authErrorEl = document.getElementById('auth-error-message');

const mainAppEl = document.getElementById('app');
const userIdEl = document.getElementById('user-id');
const authStatusEl = document.getElementById('auth-status');

const formEl = document.getElementById('add-loan-form');
const nameInput = document.getElementById('borrower-name');
const amountInput = document.getElementById('loan-amount');
const userLoansListEl = document.getElementById('user-loans-list');
const globalLoansListEl = document.getElementById('global-loans-list');

let userId = null;

const formatCurrency = amount => new Intl.NumberFormat('en-IN',{style:'currency',currency:'INR',minimumFractionDigits:2}).format(amount);
const showAuthError = msg => { authErrorEl.textContent = msg; authErrorEl.classList.remove('hidden'); };
const hideAuthError = () => { authErrorEl.textContent=''; authErrorEl.classList.add('hidden'); };

const handleSignUp = async () => {
  hideAuthError();
  try { await createUserWithEmailAndPassword(auth, authEmailInput.value, authPasswordInput.value); }
  catch(e){ showAuthError(e.message);}
};
const handleSignIn = async () => {
  hideAuthError();
  try { await signInWithEmailAndPassword(auth, authEmailInput.value, authPasswordInput.value); }
  catch(e){ showAuthError(e.message);}
};
const handleSignOut = async () => { try { await signOut(auth); } catch(e){} };

const getUserLoansRef = () => collection(db, `users/${userId}/loan_records`);
const getGlobalLoansRef = () => collection(db, `all_loans`);

const addLoan = async e => {
  e.preventDefault();
  const name = nameInput.value.trim();
  const amount = parseFloat(amountInput.value);
  if(!name || isNaN(amount) || amount <=0) return alert('Invalid data');
  await addDoc(getUserLoansRef(), {name, amount, paidAmount:0, isPaid:false, createdAt:serverTimestamp()});
  await addDoc(getGlobalLoansRef(), {name, amount, paidAmount:0, isPaid:false, createdAt:serverTimestamp()});
  nameInput.value=''; amountInput.value='';
};

const renderLoans = (loans, container) => {
  container.innerHTML='';
  if(loans.length===0){ container.innerHTML='<p class="py-2 text-gray-400">No records</p>'; return;}
  loans.forEach(loan=>{
    const paid = loan.paidAmount||0;
    const remaining = loan.amount - paid;
    const item = document.createElement('div');
    item.className='grid grid-cols-1 sm:grid-cols-5 gap-2 p-3 border-b border-gray-600';
    item.innerHTML = `<div>${loan.name}</div><div>₹${loan.amount.toFixed(2)}</div><div>Paid: ₹${paid.toFixed(2)}</div><div>Remaining: ₹${remaining.toFixed(2)}</div>
      <div class="flex gap-2">
        <button class="bg-green-500 text-white px-2 rounded">Pay</button>
        <button class="bg-red-500 text-white px-2 rounded">Delete</button>
      </div>`;
    container.appendChild(item);
  });
};

onAuthStateChanged(auth, user=>{
  if(user){
    userId = user.uid;
    authContainerEl.classList.add('hidden');
    mainAppEl.classList.remove('hidden');
    userIdEl.textContent = userId;
    authStatusEl.textContent = 'Authenticated';

    onSnapshot(query(getUserLoansRef(), orderBy('createdAt','desc')), snap=>{
      const userLoans = snap.docs.map(doc=>({...doc.data(), id:doc.id}));
      renderLoans(userLoans, userLoansListEl);
    });
    onSnapshot(query(getGlobalLoansRef(), orderBy('createdAt','desc')), snap=>{
      const globalLoans = snap.docs.map(doc=>({...doc.data(), id:doc.id}));
      renderLoans(globalLoans, globalLoansListEl);
    });
  } else {
    authContainerEl.classList.remove('hidden');
    mainAppEl.classList.add('hidden');
  }
});

loginButton.addEventListener('click', handleSignIn);
signupButton.addEventListener('click', handleSignUp);
signoutButton.addEventListener('click', handleSignOut);
formEl.addEventListener('submit', addLoan);

</script>
</body>
</html>
